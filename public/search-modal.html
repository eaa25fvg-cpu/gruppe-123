<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Find sange</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/fill/style.css"
    />

    <script src="scripts/breadcrumb.js" type="module"></script>
    <script src="scripts/song-item.js" type="module"></script>
  </head>
  <body>

    <nav-breadcrumb></nav-breadcrumb>
    <button id="openModalBtn">Open modal</button>

    <div class="modal-overlay" id="s-modal">
      <div class="modal">
        <div class="search">
          <div class="search-container">
            <img class="search-icon" src="files/search.png" />
            <form action="">
              <input
                class="search-input"
                id="searchInput"
                type="text"
                placeholder="Søg efter sange"
              />
            </form>
          </div>
        </div>
        <div class="content-inner">
          <div class="results empty-state">
            <div id="song-list" class="song-list"></div>
            <h3>Populære sange</h3>
          </div>
        </div>
      </div>
    </div>

    <div class="floating-queue">
        <div class="queue-list">
        </div>
        <div class="summary">
            <div class="text-wrapper">
                <p id="price">4 kr.</p>
                <p id="song-count">2 sange</p>
            </div>
            <button class="primary-btn">Gå til betaling</button>
        </div>
    </div>
    
    <script type="module">
      import {
        animate,
        scroll,
      } from "https://cdn.jsdelivr.net/npm/motion@latest/+esm";

      const openBtn = document.getElementById("openModalBtn");
      const closeBtn = document.getElementById("closeModalBtn");
      const modal = document.getElementById("s-modal");

      function showModal() {
        // make layout visible first
        modal.style.display = "flex";

        // animate in: from opacity 0 + scale 0.95 → opacity 1 + scale 1
        animate(
          modal,
          { opacity: [0, 1], scale: [0.95, 1] },
          { duration: 0.3, easing: "ease-out" }
        );
      }

      function hideModal() {
        // animate out: opacity 1→0 + scale 1→0.95
        const animation = animate(
          modal,
          { opacity: [1, 0], scale: [1, 0.95] },
          { duration: 0.25, easing: "ease-in" }
        );

        // After animation finishes, hide it
        animation.finished.then(() => {
          modal.style.display = "none";
        });
      }

      // event handlers
      openBtn.addEventListener("click", showModal);

      window.addEventListener("keydown", (e) => {
        if (
          e.key === "Escape" &&
          window.getComputedStyle(modal).display !== "none"
        ) {
          hideModal();
        }
      });

      window.addEventListener("click", (e) => {
        if (e.target === modal) {
          hideModal();
        }
      });
    </script>

  <script type="module">
  import { loadSongs } from './app.js';

  const songList = document.getElementById("song-list");
  const searchInput = document.getElementById("searchInput");

  // Render function
  function renderTracks(songs = []) {
    if (!songList) return;
    let html = "";
    songs.forEach(song => {
      html += `
        <song-item
          title="${song.name}"
          artist="${song.artist_name}"
          cover="${song.cover_image}"
          album="${song.album_name}"
          duration="${song.duration}">
        </song-item>
      `;
    });
    songList.innerHTML = html;
  }

  // Fetch songs dynamically
  async function init() {
    const tracks = await loadSongs(); // get data from app.js
    renderTracks(tracks);

    // Add live search
    searchInput.addEventListener("input", (e) => {
      const query = e.target.value.toLowerCase();
      const filtered = tracks.filter(track =>
        track.title.toLowerCase().includes(query)
      );
      renderTracks(filtered);
    });
  }

  init();
  </script>
  </body>
</html>
